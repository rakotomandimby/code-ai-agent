# Instructions

You are a TypeScript expert speciaized in Node.js applications built with Nx.
Your tasks are to help the user to implement new features and resolve bugs in the application.

## Architecture Overview

The application follows a monorepo architecture using Nx build system with the following structure:

## Projects Structure

- **lib** - Shared library containing core functionality
- **openai-agent** - OpenAI API agent service (port 4000)
- **googleai-agent** - Google AI API agent service (port 5000)  
- **anthropic-agent** - Anthropic API agent service (port 6000)

## OpenAI Agent Specific Informations 

The OpenAI agent supports the "Responses API" specifications.

### About the Responses API

The "Responses API" is a new API specification from OpenAI.

- Endpoint: `https://api.openai.com/v1/responses` 
- HTTP method: POST
- Headers:
  - `Content-Type: application/json`
  - `Authorization: Bearer API_KEY`

The Body payload format:

```json
{
    "instructions": "You are a car salesman.",
    "model": "gpt-5-codex",
    "stream": true,
    "input": "Tell me a three sentence bedtime story about a unicorn."
}
```

The `/v1/responses` endpoint supports multi-turn chat conversations, but with small differences in the body format compared to the Chat Completion API.

So we must convert the `messages` array to the `input` field format, which is an array of strings.

```json
{
    model: "gpt-5-codex",
    input: [
        {
            role: "system",
            content: "You are Copilot Chat for Neovim."
        },
        {
            role: "user",
            content: "Are semicolons optional in JavaScript?",
        },
        {
            role: "assistant",
            content: "Aye, they be optional, but using them can help avoid  pitfalls.",
        },
        {
            role: "user",
            content: "Give a real world example",
        }
    ],
}
```

The last element of the array must be a user message, and is the prompt to which the model will respond.

- "user" messages are instructions provided by an end user, prioritized behind developer messages.
- Messages generated by the model have the assistant role.
- "system" messages are high-level instructions provided by the application developer, prioritized ahead of all other message types.

The Responses API does not support the "temperature" parameter, so it must be remove from the request body for the `/responses` endpoint.

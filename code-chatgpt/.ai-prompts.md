# Make "await" having effect

The `./src/repository/chatgpt-repository.ts` file contains the following code:

```typescript
  save(data: Chunk) {
    if (data.kind === 'message') {
      this.db.exec(`INSERT INTO messages (id, role, content) VALUES (${data.id}, '${data.role}', '${data.content}')`);
    }
    if (data.kind === 'system_instruction') {
      this.db.exec(`INSERT INTO system_instruction (id, content) VALUES (${data.id}, '${data.content}')`);
    }
    if (data.kind === 'model_to_use') {
      this.db.exec(`INSERT INTO model_to_use (id, content) VALUES (${data.id}, '${data.content}')`);
    }
    if (data.kind === 'temperature') {
      this.db.exec(`INSERT INTO temperature (id, content) VALUES (${data.id}, '${data.content}')`);
    }
    if (data.kind === 'top_p') {
      this.db.exec(`INSERT INTO top_p (id, content) VALUES (${data.id}, '${data.content}')`);
    }
  }
```

The problem is in `./src/routes.ts`, "await" has no effect in this code.

```typescript
  if (JSONBody.system_instruction) {
    let chunk = new Chunk('system_instruction', counter, '', JSONBody.system_instruction);
    await repository.save(chunk);
    res.send({}); 
    res.end();
  }
```

Propose me a new version of the `save()` method that returns a Promise and thus will make "await" having effect.

# This is Gemini answer (4k in, 0k out)

The issue is that `db.exec()` doesn't return a Promise, so `await` has nothing to wait for.  You need to wrap the `db.exec()` call in a Promise.  Here's the corrected `save()` method:

```typescript
import { Database, RunResult } from 'sqlite3'; // Import RunResult
import Chunk from '../model/chunk';
import { MultiTurnChat } from '../model/multiturnchat';

export default class ChatGPTRepository {
  // ... (other code)

  save(data: Chunk): Promise<void> {
    return new Promise<void>((resolve, reject) => {
      let sql = '';
      if (data.kind === 'message') {
        sql = `INSERT INTO messages (id, role, content) VALUES (${data.id}, '${data.role}', '${data.content}')`;
      } else if (data.kind === 'system_instruction') {
        sql = `INSERT INTO system_instruction (id, content) VALUES (${data.id}, '${data.content}')`;
      } else if (data.kind === 'model_to_use') {
        sql = `INSERT INTO model_to_use (id, content) VALUES (${data.id}, '${data.content}')`;
      } else if (data.kind === 'temperature') {
        sql = `INSERT INTO temperature (id, content) VALUES (${data.id}, '${data.content}')`;
      } else if (data.kind === 'top_p') {
        sql = `INSERT INTO top_p (id, content) VALUES (${data.id}, '${data.content}')`;
      }

      if (sql) {
        this.db.exec(sql, (err: Error | null) => {
          if (err) {
            reject(err);
          } else {
            resolve();
          }
        });
      } else {
        resolve(); // Resolve if no matching kind
      }
    });
  }

  // ... (other code)
}
```

